#!/bin/sh

pwd_escaped=$(pwd | sed 's!/!%!g')
export CARGO_TARGET_DIR="${HOME}/tmp/${pwd_escaped}/target.rust-analyzer"
export NVIM_LISTEN_ADDRESS="/tmp/nvim-${pwd_escaped}"

# check if we can connect, otherwise remove the socket
nvr -s --nostart || rm -f "${NVIM_LISTEN_ADDRESS}"

/usr/bin/nvim -p "$@"
